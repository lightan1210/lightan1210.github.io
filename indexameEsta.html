<!DOCTYPE html>

<html>
    <head>
        <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.min.js"></script>
    </head>
    <body>

        <script>
            var config = {
                type: Phaser.AUTO,
                width: 600,
                height: 600,
                physics: {
                    default: 'arcade',
                    arcade: {
                        gravity: {y: 0}
                    }
                },
                scene: {
                    preload: preload,
                    create: create,
                    update: update
                }
            };

            var game = new Phaser.Game(config);

            var cancha, neymar, chocado, chocado2, scoreText, temporizador;

            var config, config2, config3, config4, configChoque;

            var score = 0, cantSegundos = 60, puntajeCorriendo = 5, puntajeRodando = 10, penalizacionArbitro = 2, penalizacionZuniga = 5;


            function preload()
            {

                this.load.image('pitch', 'pitch.png');

                this.load.image('explosion', 'explosion2.png');

                this.load.spritesheet('neymar', 'ney.png', {frameWidth: 35, frameHeight: 47}, 3);

                this.load.spritesheet('neymarT', 'neyTirado.png', {frameWidth: 48, frameHeight: 35}, 4);

                this.load.spritesheet('oponente', 'oponente.png', {frameWidth: 35, frameHeight: 47}, 3);

                this.load.spritesheet('zuniga', 'zuniga.png', {frameWidth: 35, frameHeight: 47}, 3);

                this.load.spritesheet('arbitro', 'arbitro.png', {frameWidth: 35, frameHeight: 47}, 3);

                this.load.audio('star', ['stars23.mp3']);
            }


            function create()
            {
                cancha = this.add.tileSprite(300, 300, 600, 600, 'pitch');
                neymar = this.physics.add.sprite(Phaser.Math.Between(50, 550), 500, 'neymar').setScale(2.5);
                oponente = this.physics.add.sprite(Phaser.Math.Between(50, 550), 0, 'oponente').setScale(2.5);
                zuniga = this.physics.add.sprite(Phaser.Math.Between(50, 550), 0, 'zuniga').setScale(2.5);
                arbitro = this.physics.add.sprite(Phaser.Math.Between(50, 550), 0, 'arbitro').setScale(2.5);
                oponente2 = this.physics.add.sprite(Phaser.Math.Between(50, 550), 0, 'oponente').setScale(2.5);

                neymar.setCollideWorldBounds(true);

                this.physics.add.overlap(neymar, oponente, choque, null, this);
                this.physics.add.overlap(neymar, oponente2, choque, null, this);

                this.physics.add.overlap(neymar, zuniga, choqueZ, null, this);

                this.physics.add.overlap(neymar, arbitro, choqueA, null, this);

                exploto =  this.add.image(10, 10, 'explosion').setScale(1.5);

                config = {
                    key: 'walkNey',
                    frames: this.anims.generateFrameNumbers('neymar', {start: 0, end: 2, first: 0}),
                    frameRate: 10,
                    repeat: -1
                            //repeatDelay: 3
                };

                config2 = {
                    key: 'walkOponente',
                    frames: this.anims.generateFrameNumbers('oponente', {start: 0, end: 2, first: 0}),
                    frameRate: 10,
                    repeat: -1
                            //repeatDelay: 3
                };

                config3 = {
                    key: 'rodar',
                    frames: this.anims.generateFrameNumbers('neymarT', {start: 0, end: 3, first: 0}),
                    frameRate: 10,
                    repeat: -1
                            //repeatDelay: 3
                };

                config4 = {
                    key: 'walkZunniga',
                    frames: this.anims.generateFrameNumbers('zuniga', {start: 0, end: 2, first: 0}),
                    frameRate: 10,
                    repeat: -1
                            //repeatDelay: 3
                };

                config5 = {
                    key: 'walkArbitro',
                    frames: this.anims.generateFrameNumbers('arbitro', {start: 0, end: 2, first: 0}),
                    frameRate: 10,
                    repeat: -1
                            //repeatDelay: 3
                };


                this.anims.create(config);
                this.anims.create(config2);
                this.anims.create(config3);
                this.anims.create(config4);
                this.anims.create(config5);

                neymar.anims.play('walkNey');
                oponente.anims.play('walkOponente');
                oponente2.anims.play('walkOponente');
                zuniga.anims.play('walkZunniga');
                arbitro.anims.play('walkArbitro');

                this.sound.play('star');

                //Temporizador y puntaje
                temporizador = this.time.addEvent({delay: 1000, callback: descontar, callbackScope: this});
                scoreText = this.add.text(16, 16, 'Score: 0', {fontSize: '32px', fill: '#f00'});
                timeText = this.add.text(420, 16, 'Time: ' + cantSegundos, {fontSize: '32px', fill: '#f00'});


                chocado = false;
                mostarExp = false;
                exploto.visible = false; 

                //  Input Events
                cursors = this.input.keyboard.createCursorKeys();
            }

            function update() {
 
                if (oponente.y >= 1000) {
                    oponente.visible = true;
                    oponente.y = 0;
                    oponente.x = Phaser.Math.Between(50, 300);
                } else
                    oponente.y += 2; //El oponente avanza 2 lugares

                if (oponente2.y >= 1000) {
                    oponente2.visible = true;
                    oponente2.y = 0;
                    oponente2.x = Phaser.Math.Between(300, 550);
                } else
                    oponente2.y += 2; //El oponente avanza 2 lugares

                if (zuniga.y >= 1000) {
                    zuniga.visible = true;
                    zuniga.y = 0;
                    zuniga.x = Phaser.Math.Between(50, 550);
                } else
                    zuniga.y += 5; //ZuÃ±iga avanza 5 lugares

                if (arbitro.y >= 1000) {
                    arbitro.visible = true;
                    arbitro.y = 0;
                    arbitro.x = Phaser.Math.Between(50, 550);
                } else {
                    arbitro.x = neymar.x;
                    arbitro.y += 1; //Avanza el arbitro un lugar
                }

                neymar.body.setVelocity(0);

                if (cursors.left.isDown) {
                    neymar.setVelocityX(-160);
                } else if (cursors.right.isDown) {
                    neymar.setVelocityX(160);
                } else if (cursors.up.isDown) {
                    if (chocado) {
                        chocado = false;
                        //this.sound.stopAll();
                        neymar.anims.play('walkNey');
                    }
                }
                
                if(mostarExp){
					mostarExp = false;
				}else{
					exploto.visible = false; 
				}               
            
            }

            function descontar() {

                if (cantSegundos > 0) {
                    cantSegundos--;
                    timeText.setText('Time: ' + cantSegundos);
                    temporizador.reset({delay: 1000, callback: descontar, callbackScope: this, repeat: 1});
                } else {

                    timeText.x = 10;
                    timeText.y = 250;
                    timeText.setScale(2);
                    timeText.setText('FIN DEL PARTIDO');

                    this.scene.pause();
                    this.sound.stopAll();
                    gameOver = true;
                }
            }

            function choque(ney, oponent) {

                if (!mostarExp) {
                 mostarExp = true;
                 exploto.visible = true;
                 exploto.x = ney.x;
				 exploto.y = ney.y;
                }

                if (!chocado) {

                    chocado = true;
                    oponent.visible = false;
                    oponent.y = 1500;
                    ney.anims.play('rodar');

                    score += puntajeCorriendo;

                } else {
                    oponent.visible = false;
                    oponent.y = 1500;
                    score += puntajeRodando;
                }
                
                


                scoreText.setText('Score: ' + score);
            }

            function choqueA(player, player2) {

                if (!chocado) {
                    player2.visible = false;
                    player2.y = 1500;
                } else {
                    player2.visible = false;
                    player2.y = 1500;
                    cantSegundos -= penalizacionArbitro;
                    timeText.setText('Time: ' + cantSegundos);
                }

            }

            function choqueZ(player, player2) {

				  if (!mostarExp) {
                 mostarExp = true;
                 exploto.visible = true;
                 exploto.x = player.x;
				 exploto.y = player.y;
                }

                if (!chocado) {

                    chocado = true;
                    player2.visible = false;
                    player2.y = 1500;

                    player.anims.play('rodar');

                    cantSegundos -= penalizacionZuniga;
                    timeText.setText('Time: ' + cantSegundos);
                } else {
                    player2.visible = false;
                    player2.y = 1500;
                    cantSegundos -= penalizacionZuniga;
                    timeText.setText('Time: ' + cantSegundos);
                }

            }

        </script>

    </body>
</html>

